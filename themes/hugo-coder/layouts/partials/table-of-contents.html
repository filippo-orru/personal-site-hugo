{{ $className := .className }}
{{ $context := .context }}
{{ if and
    (gt (len (findRE "\n#+" $context.RawContent)) 2) 
    (or .manual (eq (len (findRE "table-of-contents" $context.RawContent)) 0))
}}
<aside class="table-of-contents {{ $className }}" alt="Table of contents">
    {{ $context.Page.TableOfContents }}
</aside>
{{ end }}